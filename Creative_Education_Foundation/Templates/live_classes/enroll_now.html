{% extends 'base.html' %}
{% load static %}

{% block title %}Complete payment – {{ course.title }} | CEF{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'pages/liveClasses/payment_initiate.css' %}">
{% endblock %}

{% block content %}
<div class="payment-container">
  <div class="payment-header">
    <div class="payment-icon">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
      </svg>
    </div>
    <h1>Complete your payment</h1>
    <p>Secure your seat for <strong>{{ course.title }}</strong></p>
  </div>

  <!-- 1  –  details  -->
  <div class="payment-details">
    <div class="detail-row">
      <span class="detail-label">Course:</span>
      <span class="detail-value">{{ course.title }}</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Applicant:</span>
      <span class="detail-value">{{ user.get_full_name|default:user.username }}</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Enrollment ID:</span>
      <span class="detail-value">#{{ enrollment.id }}</span>
    </div>

    {% if discount > 0 %}
    <div class="detail-row">
      <span class="detail-label">Original price:</span>
      <span class="detail-value"><s>Rs. {{ course.price }}</s></span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Discount:</span>
      <span class="detail-value">Rs. {{ discount }}</span>
    </div>
    {% endif %}

    <div class="detail-row total">
      <span class="detail-label">Amount to pay:</span>
      <span class="detail-value">Rs. {{ discounted_price }}</span>
    </div>
  </div>


  
  <!-- 2  –  choose wallet  -->
  <div class="wallet-buttons">
    <form method="post" action="{% url 'confirm_enrollment_payment' enrollment.id %}">
      {% csrf_token %}
      <input type="hidden" name="payment_method" value="khalti">
      <button type="submit" class="btn-pay khalti">
        <img src="{% static 'img/khalti.png' %}" alt="Khalti">  Pay with Khalti
      </button>
    </form>

    <form method="post" action="{% url 'confirm_enrollment_payment' enrollment.id %}">
      {% csrf_token %}
      <input type="hidden" name="payment_method" value="esewa">
      <button type="submit" class="btn-pay esewa">
        <img src="{% static 'img/esewa.png' %}" alt="eSewa">  Pay with eSewa
      </button>
    </form>
  </div>

  <a href="{% url 'course_detail' course.id %}" class="btn-cancel">←  Back to course</a>

  <div class="payment-note">
    You will be redirected to the chosen payment gateway.  
    After successful payment your seat will be confirmed instantly.
  </div>
</div>
{% endblock %}